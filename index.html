<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∏—Ç–æ–º–µ—Ü</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        .stat {
            margin: 10px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>üêæ –ü–∏—Ç–æ–º–µ—Ü: –ú—É—Ä–∑–∏–∫ üê±</h1>
    <div id="stats">
        <div class="stat">üí∞ –ú–æ–Ω–µ—Ç—ã: <span id="coins">0</span></div>
        <div class="stat">‚ö°Ô∏è –≠–Ω–µ—Ä–≥–∏—è: <span id="energy">100</span></div>
        <div class="stat">üçî –°—ã—Ç–æ—Å—Ç—å: <span id="hunger">50</span></div>
        <div class="stat">üòä –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: <span id="mood">80</span></div>
    </div>
    <button onclick="earnCoins()">–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–Ω–µ—Ç—ã üí∞</button>
    <button onclick="feedPet()">–ü–æ–∫–æ—Ä–º–∏—Ç—å –ø–∏—Ç–æ–º—Ü–∞ üçó</button>
    <button onclick="playWithPet()">–ò–≥—Ä–∞—Ç—å —Å –ø–∏—Ç–æ–º—Ü–µ–º üéæ</button>
    <button onclick="restPet()">–û—Ç–¥—ã—Ö–∞—Ç—å üò¥</button>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        const tg = window.Telegram.WebApp;

        // –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userId = tg.initDataUnsafe.user.id;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData() {
            const response = await fetch(`/api/user/${userId}`);
            const data = await response.json();
            document.getElementById('coins').textContent = data.coins;
            document.getElementById('energy').textContent = data.energy;
            document.getElementById('hunger').textContent = data.hunger;
            document.getElementById('mood').textContent = data.mood;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function saveUserData(data) {
            await fetch(`/api/user/${userId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
        }

        // –î–µ–π—Å—Ç–≤–∏—è
        async function earnCoins() {
            let data = await fetch(`/api/user/${userId}`).then(res => res.json());
            data.coins += 10;
            data.energy -= 10;
            saveUserData(data);
            loadUserData();
        }

        async function feedPet() {
            let data = await fetch(`/api/user/${userId}`).then(res => res.json());
            if (data.coins >= 5) {
                data.coins -= 5;
                data.hunger += 20;
                data.mood += 10;
                saveUserData(data);
                loadUserData();
            } else {
                alert("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
            }
        }

        async function playWithPet() {
            let data = await fetch(`/api/user/${userId}`).then(res => res.json());
            data.mood += 15;
            data.energy -= 10;
            saveUserData(data);
            loadUserData();
        }

        async function restPet() {
            let data = await fetch(`/api/user/${userId}`).then(res => res.json());
            data.energy += 30;
            data.mood -= 5;
            saveUserData(data);
            loadUserData();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadUserData();
    </script>
</body>
</html>